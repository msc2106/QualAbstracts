ABSTRACT: 
A wave-vector-frequency-domain method is presented to describe one-directional forward or backward acoustic wave propagation in a nonlinear homogeneous medium. Starting from a frequency-domain representation of the second-order nonlinear acoustic wave equation, an implicit solution for the nonlinear term is proposed by employing the Green’s function. Its approximation, which is more suitable for numerical implementation, is used. An error study is carried out to test the efficiency of the model by comparing the results with the Fubini solution. It is shown that the error grows as the propagation distance and step-size increase. However, for the specific case tested, even at a step size as large as one wavelength, sufficient accuracy for plane-wave propagation is observed. A two-dimensional steered transducer problem is explored to verify the nonlinear acoustic field directional independence of the model. A three-dimensional single-element transducer problem is solved to verify the forward model by comparing it with an existing nonlinear wave propagation code. Finally, backward-projection behavior is examined. The sound field over a plane in an absorptive medium is backward projected to the source and compared with the initial field, where good agreement is observed. 
 
PREDICTION: 
Subsequently, a variety of Burgers equation-modified ASA simulations have been reported.4,6 ASA solutions of the Westervelt equation7,8 have also been studied.9 While commonly used modeling approaches apply the KZK (Khokhlov–Zabolotskaya–Kuznetsov) equation10,11 to solve for the nonlinear sound field, the Westervelt equation can potentially be more accurate in determining the field, since it does not rely on a parabolic approximation.12,13 In general, ASA-based approaches solving the Westervelt equa- tion can be computationally appealing especially when para- bolic approximation breaks, and the frequency and angular spectrums are narrow. The frequency-domain formulation also allows straight- forward treatment of general dispersion cases,17,18 which can have complicated representation in the space–time do- main.19–21 Variations in the time-domain approach center on efficient methods to model the solutions.22–25 On the other hand, the general case of anomalous dispersion can be handled with relative ease in wave-vector space.26 A rele- vant medical example of anomalous dispersion is trabecular bone. (2) can be derived by using the one- dimensional (1-D) Green’s function30 and is written as (deri- vations can be found in Appendix A) Pz14P0eiKzMe iKz 2iK 1 z eiKz 0 F Pz0 dz0 M2e iK2z 2iK2  1 z eiK2z 0 F Pz0 dz0 M2e iK2z 2iK2 z 0 eiK2z 0 F Pz0 dz0 M2e iK2zeiK2z 2iK2  P0; K0P0;K0 K0 1 z eiKaKbK2z 0 dz0 
 
FULL TEXT: 
  VC 2011 Acoustical Society of America. [DOI: 10.1121/1.3504705] PACS number(s): 43.25.Cb, 43.25.Jh [OAS] Pages: 32–46 I. INTRODUCTION Planar-projection methods calculate an acoustic field at arbitrary points in space or time, given the field distribution at some initial plane.1,2 Such methods use a transfer func- tion, or a series of transfer functions, that operate in Fourier space. These approaches are computationally advantageous compared to space–time methods,3 as they represent the wave equation in the form of an ordinary differential equa- tion (ODE) as opposed to its partial differential (PDE) form in space–time. If the medium is linear and homogeneous, the ODE will have a known solution,1 and a projection to any new plane requires only a single operation. In heterogeneous media, an exact solution cannot be described. However, the reduction of the wave equation from a PDE to an ODE still represents a significant numeric simplification as well as rel- atively straightforward implementation.4 For instance, planar projection has been applied to multi-layer media and is able to account for refraction and single reflections.5 While most planar approaches are linear, nonlinear tech- niques have been investigated and utilized. Christopher and Parker5 performed projections by a modified angular spectrum approach (ASA) using applications of Burgers equa- tion in the time domain. Subsequently, a variety of Burgers equation-modified ASA simulations have been reported.4,6 ASA solutions of the Westervelt equation7,8 have also been studied.9 While commonly used modeling approaches apply the KZK (Khokhlov–Zabolotskaya–Kuznetsov) equation10,11 to solve for the nonlinear sound field, the Westervelt equation can potentially be more accurate in determining the field, since it does not rely on a parabolic approximation.12,13 In general, ASA-based approaches solving the Westervelt equa- tion can be computationally appealing especially when para- bolic approximation breaks, and the frequency and angular spectrums are narrow. For example, in weakly nonlinear con- tinuous wave cases, frequency space can be reduced to as little as the fundamental frequency and the second harmonic, and they are projected separately.14,15 Additionally, pre-selection of a reduced region of k-space can allow a specific portion of a propagating field—typically the forward propagating wave—to be studied. While most available forward nonlinear wave approaches assume the main nonlinear distortion in the direction normal to the source plane,5,6 only a few works in the literature have proposed methods that are “omni-directional” in terms of the nonlinear acoustic field.16 This ability to consider nonlinear distortion in a direction other than normal to the source plane is especially advantageous when a strongly focused or steered transducer is to be modeled. The approach introduced in this a)Author to whom correspondence should be addressed. Present address: Focused Ultrasound Laboratory, Brigham and Women’s Hospital, EBRC 521, 221 Longwood Avenue, Boston, Massachusetts 02115. Electronic mail: gclement@hms.harvard.edu 32 J. Acoust. Soc. Am. 129 (1), January 2011 0001-4966/2011/129(1)/32/15/$30.00 VC 2011 Acoustical Society of America Downloaded 18 Mar 2011 to 131.215.220.185. Redistribution subject to ASA license or copyright; see http://asadl.org/journals/doc/ASALIB-home/info/terms.jsp paper embraces this ability as it essentially avoids using a plane-wave solution. More importantly, it will be demon- strated that in the frequency-domain representation of the Westervelt equation, convolutions in the vector space emerge. This is essential, as it automatically considers the interaction of all waves propagating in every direction, which is a novel point in this paper. This may prove particularly useful for strongly focused sources or sources with sharp edges, i.e., with broadband spatial spectrum. The frequency-domain formulation also allows straight- forward treatment of general dispersion cases,17,18 which can have complicated representation in the space–time do- main.19–21 Variations in the time-domain approach center on efficient methods to model the solutions.22–25 On the other hand, the general case of anomalous dispersion can be handled with relative ease in wave-vector space.26 A rele- vant medical example of anomalous dispersion is trabecular bone. In contrast to most biologic tissues, phase velocity in trabecular bone tends to decrease with frequency.27 The present work indicates how the nonlinear frequency-domain wave equation can be further transformed into the wave- vector-frequency domain, where it has a known solution. It will be shown that this solution can be used for planar pro- jection and is valid under arbitrary dispersion conditions. The present study also considers yet another potential advantage of the method: The ability to propagate a nonlin- ear signal backward toward the source in absorptive media. In this manner a field measured away from a transducer could be used to predict field behavior closer to the radiator. Alternatively, a desired field could be synthetically gener- ated and then projected backward to provide information on the requirement of the radiational and dimensional require- ments of the source. The process requires the time history of a sound field over a given spatial plane as well the acoustic properties of the propagation medium. Successfully imple- mented, this approach could provide data to predict the acoustic field, including harmonic and low frequency por- tions of the signal at any point in space. To demonstrate the approach, we develop a general algorithm, which is then used to model the specific case of the Westervelt equation. This algorithm is first verified by comparing results with analytic solutions for a plane wave. Meanwhile, a method for more efficient implementation is considered by maximizing the algorithm step size. We test whether propagation steps in the order of the fundamental wavelength are possible, as opposed to the 10–20 steps per wavelength required in finite-difference time-domain or finite element methods.3 The optimal step size for a given problem is found by a study that measures error as a function of step size and propagation distance. A two-dimensional (2-D) steered transducer is then studied to demonstrate the directional independence of this approach when calculating the nonlinear acoustic field. Furthermore, a three-dimen- sional (3-D) focused transducer problem is studied for verifi- cation of the forward model. The present method is compared with an existing nonlinear angular spectrum wave propagation code28 for the case of a Gaussian-modulated si- nusoidal pulse. Finally, the accuracy of the algorithm is tested by implementing the backward model in absorptive media, and it is shown that the backward projected field agrees well with the initial signal. II. THEORY Field calculations will be performed using a propagation algorithm that operates in both the temporal and spatial fre- quency domains. Although a number of temporal frequency- domain nonlinear algorithms have been reported,17,18 the present approach is unique in that it also solves the nonlinear term in the spatial frequency domain. In this way, the inter- action of waves in all directions (all wave vectors) are included automatically in the solution, not only in one direc- tion of propagation kz as in previously used KZK or one- direction Westervelt equation models,5,6 which is expected to be advantageous for strongly focused transducers or sour- ces with broadband spatial spectra. Although the frequency-domain equation is more gen- eral, it is instructive to start with the time-domain Westervelt equation in a homogeneous medium for the purpose of com- parison. The equation assumes a thermo-viscous medium and is given by r2pðr; tÞ  1 c20 @2 @t2 pðr; tÞ þ d c40 @3 @t3 pðr; tÞ þ b q0c 4 0 @2 @t2 p2ðr; tÞ ¼ 0; (1) where p is the sound pressure, c0 is the sound speed, d is the sound diffusivity, b is the nonlinearity coefficient, and q0 is the ambient density. We note that the solution to the Wester- velt equation describes an approximation of quasi-plane waves, and is valid for directional sound beams once the prop- agation distance becomes much larger than a wavelength.11 By Fourier solution of the temporal dimension, as well as the Cartesian x- and y-dimensions, Eq. (1) is transformed from a PDE to an ODE,29 @2 @z2 Pðkx; ky; z;xÞ þ K2Pðkx; ky; z;xÞ  bx 2 q0c 4 0 Pðkx; ky; z;xÞ  Pðkx; ky; z;xÞ ¼ 0; (2) where Pðkx;ky; z;xÞ ¼ ð1 1 ð1 1 ð1 1 pðr; tÞeiðkxxþkyyxtÞdxdydt; (3) Pðkx; ky; z;xÞ  Pðkx; ky; z;xÞ ¼ ð1 1 ð1 1 ð1 1 Pðk0x; k0y; z;x0Þ  Pðkx  k0x; ky  k0y; z;x x0Þdk0xdk0ydx0; (4) K2 ¼ x 2 c20  k2x  k2y  i dx3 c40 ; (5) J. Acoust. Soc. Am., Vol. 129, No. 1, January 2011 Jing et al.: Nonlinear wave propagation 33 Downloaded 18 Mar 2011 to 131.215.220.185. Redistribution subject to ASA license or copyright; see http://asadl.org/journals/doc/ASALIB-home/info/terms.jsp and x is the angular frequency, kx and ky are the wave num- bers, and the convolution in Eq. (2) is with respect to kx, ky, and x. K is defined as K ¼ þ ffiffiffiffiffiffiffiffiffiðK2Þp for x < 0 and K ¼  ffiffiffiffiffiffiffiffiffiðK2Þp for x > 0. As noted above, although Eq. (2) was derived from the Westervelt equation, in fact it is much more general, since the dispersion relation, i.e., Eq. (5), can readily be replaced by an arbitrary relation. The 3-D auto-con- volution resulting from the nonlinear term in Eq. (1) serves the role of temporal frequency mixing, transferring energy both into and out of the higher components of the frequency spectrum. It also transfers energy between spatial frequencies, so that the interaction between wave propagation in different directions is accounted. Although calculation of this convolu- tion is the most computationally demanding part of the pres- ent algorithm, it nevertheless could be made relatively efficient using fast Fourier transforms in combination with an optimization strategy.16 Presently, however, only the fast Fou- rier transforms are used to accelerate the convolution. The solution of Eq. (2) can be derived by using the one- dimensional (1-D) Green’s function30 and is written as (deri- vations can be found in Appendix A) PðzÞ¼Pð0ÞeiKzþMe iKz 2iK ðþ1 z eiKz 0 F Pðz0Þð Þ Me iKz 2iK ðþ1 z eiKz 0 F Pðz0Þð Þdz0 þMe iKz 2iK ðz 0 eiKz 0 F Pðz0Þð Þdz0  ðz 0 eiKz 0 F Pðz0Þð Þdz0   ; (6) where M ¼ bx 2 q0c 4 0 and F Pðz0Þð Þ ¼ Pðkx; ky; z0;xÞ  Pðkx; ky; z0;xÞ: This solution is implicit because of the unknown function F inside the integral. It is also not suitable for numerical imple- mentation because of the integral from z to þ1. However, it will be shown below that, at least for a weakly nonlinear case, MeiKz 2iK ðþ1 z eiKz 0 F Pðz0Þð Þ Me iKz 2iK ðþ1 z eiKz 0 F Pðz0Þð Þdz0  Me iKz 2iK ðz 0 eiKz 0 F Pðz0Þð Þdz0   Me iKz 2iK ðz 0 eiKz 0 F Pðz0Þð Þdz0  ; (7) so that Eq. (6) can be simplified to PðzÞ ¼ Pð0ÞeiKz þMe iKz 2iK ðz 0 eiKz 0 F Pðz0Þð Þdz0: (8) This approximated solution, i.e., Eq. (8), will be used throughout the paper. Numerical results presented below will demonstrate that this approximation is valid even in strongly nonlinear cases. To further simplify the problem, validation is performed for a continuous wave, which can more readily be verified against other methods. However, this procedure generalizes to transient cases. Moreover, though only results at the second harmonic are shown here, similar equations can be derived for any harmonic. A third harmonic example is shown in Appen- dix B. The advantage of considering a weakly nonlinear case is that it allows P(z0) at the fundamental frequency to be sub- stituted by its linear representation P(0)exp(iKz0), while intro- ducing only negligible errors. To proceed, it is assumed that the attenuation is larger than zero [im(K) > 0, so the integra- tion to þ1 converges] but is sufficiently small so that it can be neglected in the derivation below for simplification. For the second harmonics, the left hand side of Eq. (7) reads M2e iK2z 2iK2 ðþ1 z eiK2z 0 F Pðz0Þð Þdz0 M2e iK2z 2iK2 ðþ1 z eiK2z 0 F Pðz0Þð Þdz0 M2e iK2z 2iK2 ðz 0 eiK2z 0 F Pðz0Þð Þdz0 M2ðe iK2zeiK2zÞ 2iK2 ð Pð0; ~K0ÞPð0;K0  ~K0Þ  ðþ1 z eiðKaþKbþK2Þz 0 dz0d ~K0 M2e iK2z 2iK2 ð Pð0; ~K0ÞPð0;K0  ~K0Þ ðz 0 eiðKaþKbþK2Þz 0 dz0d ~K0 ¼M2e iK2z 2K2 ð eiðKaþKbK2Þz1 KaþKbþK2 Pð0; ~K0ÞPð0;K0  ~K0Þd ~K0; (9) where Ka ¼ ffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffi x1 c0  2  ~K0 2 s ; Kb ¼ ffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffi x1 c0  2  K0  ~K0 2 s ; K2 ¼ ffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffi x2 c0  2  K0j j2 s ; M2 ¼ bx 2 2 q0c 4 0 ; (10) and x1 and x2 are the negative angular frequencies for the fundamental and second harmonics, respectively. Similarly, the right hand side of Eq. (7) yields M2e iK2z 2iK2 ðz 0 eiK2z 0 F Pðz0Þð Þdz0   M2e iK2z 2K2 ð eiðKaþKbK2Þz1 ðKaþKbK2Þ Pð0; ~K0ÞPð0;K0  ~K0Þd ~K0: (11) The total solution for the second harmonic [Eq. (9) þ Eq. (11)] is PðzÞ ¼ 4bk 2 1 q0c 2 0 ð eiðKaþKbÞz eiK2z K22  ðKaþKbÞ2 Pð0; ~K0ÞPð0;K0  ~K0Þd ~K0; (12) where k1 ¼ x1=c0: It is noted that this solution differs from the solution in Ref. 14 by a factor of 1 2 . This is because presently both 34 J. Acoust. Soc. Am., Vol. 129, No. 1, January 2011 Jing et al.: Nonlinear wave propagation Downloaded 18 Mar 2011 to 131.215.220.185. Redistribution subject to ASA license or copyright; see http://asadl.org/journals/doc/ASALIB-home/info/terms.jsp negative and positive frequencies are used, so the energy is split into half to both frequencies, and this factor of 1 2 produces a factor of 1 4 inside the integral of Eq. (12), i.e., Pð0; ~K0ÞPð0;K0  ~K0Þ: In addition, the above section only discusses the case where the angular frequency is x2. For the total solution, which includes the amplitude at x2, the solution has to be multiplied by 2. This results in a final cor- rection factor of 1 4  2 ¼ 1 2 , and Eq. (12) recovers the solu- tion in Ref. 14. Considering a 1-D case, it is more straightforward to see that Eq. (7) holds, because Eq. (9) reduces to 0 while Eq. (11) does not. This 1-D case is in fact a good approxima- tion to a highly directional 3-D case. For a more general 3-D problem, the validity of Eq. (7) is not as obvious, but it can be recognized that the difference between Eqs. (9) and (11) comes primarily from (Ka þ Kb þ K2) and (Ka þ Kb  K2) in the denominators. For cases tested in this study, the for- mer is typically much larger than the latter in directions where the wave energy is significant, making Eq. (7) a good approximation. That is, since the energy in the direction of K2  0, i.e., parallel to the source plane, is negligible, the error introduce by this approximation is reasonably small. However, the validity of Eq. (7) becomes questionable when the energy along a direction nearly parallel to the source plane is not weak, e.g., a point source. A 2-D example was first implemented to verify that under a more general situation Eq. (7) still holds. Details of the algorithm will be discussed in Sec. III. A strongly focused transducer with a size of 20 mm and a focus length of 5 mm was considered. The fundamental frequency was 1 MHz. The signal source amplitude was 100 kPa. Attenua- tion was assumed negligible. Sound speed in the medium was 1500 m/s, the density was 1000 kg/m3, and the non- linearity coefficient was 3.5. Figure 1(a) shows the results along the axis for Eqs. (11) and (12), where the whole solu- tion denotes Eq. (12) [the sum of Eqs. (11) and (9)] and the partial solution denotes Eq. (11). Figure 1(b) shows the results along the lateral dimension at a distance of 1.9 cm from the source. Equation (8) was also implemented and can be found in Fig. 1 shown as the present solution. Good agreement found between the whole solution and the partial solution indicates the validity of Eq. (7). Closer scrutiniza- tion reveals that the error decreases exponentially with dis- tance z. These comparisons also verify the present method for a strongly focused transducer which might be incorrectly analyzed by a method that does not consider the interaction between waves in different angles and presumes nonlinear distortion mainly in the z axis. For more strongly nonlinear cases, the situation be- comes considerably more complex. It is expected by consid- ering higher order approximation using the perturbation method, explicit format can be obtained for the function F, and Eq. (7) can be evaluated. A systematic study is not pur- sued here but is expected to be reported in a future paper. Nevertheless, a simple example will be demonstrated in this paper. A moderately nonlinear 1-D problem is now considered, where the continuous wave is again used for excitation. For a 1-D case, attenuation must be taken into account as it restricts the harmonic components reasonably small so that the moderate nonlinearity assumption is valid. For the funda- mental frequency, the right hand side of Eq. (7) becomes MeiKz 2iK ðz 0 eiKz 0 F Pðz0Þð Þdz0 ¼ eik1z 2M1 2ik1 ðz 0 eik1z 0 Pðz0;x1ÞPðz0;x2Þdz0; (13) where M1 ¼ bx 2 1 q0c 4 0 : Substituting the weak nonlinear approximation for the second harmonics, which can be easily obtained following the above procedure, Pðz0;x2Þ ¼ 4bk 2 1 q0c 2 0 e2ik 0 1 z0  eik02z0 k 02 2  4k021 P2ð0;x1Þ; (14) FIG. 1. The sound pressure amplitude of the second harmonic (a) along the axis for different solutions and (b) along the lateral dimension for different solutions. J. Acoust. Soc. Am., Vol. 129, No. 1, January 2011 Jing et al.: Nonlinear wave propagation 35 Downloaded 18 Mar 2011 to 131.215.220.185. Redistribution subject to ASA license or copyright; see http://asadl.org/journals/doc/ASALIB-home/info/terms.jsp where k01 ¼ ffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffi x1 c0  2  i dx 3 1 c40 s ; k02 ¼ ffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffi x2 c0  2  i dx 3 2 c40 s ; into Eq. (13) will only result in a higher order error [linear projection for the fundamental frequency is also used to rep- resent P(z0,x1)] and leads to 4bk21M1 q0c 2 0k 0 1 ðk01  k001Þeiðk 0 2 k1Þz  ðk02  k01  k001Þeið2k 0 1 k00 1 Þz  ð2k01  k02Þeik 0 1 z ðk01  k001Þðk02  k01  k001Þðk022  4k021 Þ P3ð0;x1Þ; (15) where k 0 1 ¼ ffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffi x1=c0ð Þ2þiðdx31=c40Þ q : On the other hand, in the same fashion, the left hand side of Eq. (7) reduces to MeiKz 2iK ðþ1 z eiKz 0 F Pðz0Þð Þdz0 Me iKz 2iK ðþ1 z eiKz 0 F Pðz0Þð Þdz0 Me iKz 2iK ðz 0 eiKz 0 F Pðz0Þð Þdz0 ¼  4bk 2 1M1 q0c 2 0k 0 1 ð3k01  k001Þeiðk 0 2 k00 1 Þz  ðk02 þ k01  k001Þeið2k 0 1 k00 1 Þz  ð2k01  k02Þeik 0 1 z ð3k01  k001Þðk02 þ k01  k001Þðk022  4k021 Þ P3ð0;x1Þ: (16) Although not presented here, straightforward numerical verification shows that the absolute value of Eq. (15) rapidly becomes much larger than Eq. (16) as z increases, again confirming the validity of Eq. (7). The total solution for the fundamental frequency can be then written as Pð0;x1Þeik01z þ 4bk 2 1M1 q0c 2 0k 0 1 ðk01  k001Þeiðk 0 2 k00 1 Þz  ðk02  k01  k001Þeið2k 0 1 k00 1 Þz  ð2k01  k02Þeik 0 1 z ðk01  k001Þðk02  k01  k001Þðk022  4k021 Þ P3ð0;x1Þ; (17) which has been compared with the numerical solution of the Burgers equation11 with an error less than 1% for a moder- ately nonlinear case, considering a plane wave generated by a mono-frequency source with a frequency of 5 MHz and peak amplitude of 6.4 MPa, propagating in a medium with a speed of sound 1500 m/s, nonlinearity coefficient 3.5, diffusivity 8  104. This represents a moderately nonlinear problem, where the shock-formation distance is slightly smaller than the absorption length (2c0 3/dx2). Comparing Eq. (17) with its weakly nonlinear approximation Pð0;x1Þeik01z; the maximum error has been found to be around þ10% (“þ” indicates the weakly nonlinear approximation overestimates the value, vice versa for “”) across z ¼ 0 to 1. This error actually con- verges at a certain distance, as the second harmonic again becomes much smaller than the fundamental once again mak- ing the weakly nonlinear approximation valid. Substituting Eq. (17) into Eq. (6) leads to the solution at the second har- monic for a moderately nonlinear problem. Numerically eval- uating the right hand side of Eq. (7) reveals that the weakly nonlinear approximation gives a maximum error of about þ23% while also þ23% for the left hand side. These two errors also grow at a similar rate and eventually converge at a certain distance, indicating that the error of evaluating their quotient will be smaller than þ23%. In this specific case, the maximum error is 8%. Next, a 3-D moderately nonlinear problem is consid- ered. Although the final solution will be different, it is assumed that the error of evaluating the quotient on the left and right hand sides of Eq. (7) using the weakly nonlinear approximation is also in the order of 610%. It has already been shown that Eq. (7) is valid using the weakly nonlinear approximation, therefore, the left hand side of Eq. (7) should still be much smaller than the right hand side even consider- ing the error of this magnitude. Considering a potential physical explanation of why MeiKz 2iK ðþ1 z eiKz 0 F Pðz0Þð Þ Me iKz 2iK ðþ1 z eiKz 0 F Pðz0Þð Þdz0    Me iKz 2iK ðz 0 eiKz 0 F Pðz0Þð Þdz0  ; (18) it is noted that the integrals represent contributions from the inhomogeneous term in Eq. (2), which can also be viewed as contributions from virtual sources.11 Since only the forward wave propagation is considered, the virtual sources exist be- tween 0 and z. Therefore, the integrals from z to þ1 should be zero, or at least negligible. The integral MeiKz2iK ðz 0 eiKz 0 F Pðz0Þð Þdz0  is also very small compared with 36 J. Acoust. Soc. Am., Vol. 129, No. 1, January 2011 Jing et al.: Nonlinear wave propagation Downloaded 18 Mar 2011 to 131.215.220.185. Redistribution subject to ASA license or copyright; see http://asadl.org/journals/doc/ASALIB-home/info/terms.jsp MeiKz2iK ðz 0 eiKz 0 F Pðz0Þð Þdz0 : For all the simulations carried out in this study, keeping the integral MeiKz 2iK ðz 0 eiKz 0 F Pðz0Þð Þdz0 in the solution introduces negligible differences. This becomes more clear considering a 1-D propagation problem: Suppose a wave is projected in a lossless medium for a small distance dz, so that the linear projection is still valid, we have ðdz 0 eiKz 0 F Pðz0Þð Þdz0  ðdz 0 eiKz 0 ð Pðx x0; 0ÞeiðKK0Þz0Pðx0; 0ÞeiK0z0dx0dz0 ¼ eiKdzdz sinðKdzÞ Kdz ð Pðx x0; 0ÞPðx0; 0Þdx0; (19) where K0 ¼ x0/c. In a similar fashion, we have ðdz 0 eiKz 0 F Pðz0Þð Þdz0 ¼ dz ð Pðx x0; 0ÞPðx0; 0Þdx0: (20) The absolute values of Eqs. (19) and (20) differ by a factor of sin(Kdz)/Kdz. Although the decay rate is slower than ex- ponential, this sinc function decays from 1 to an infinitesimal number with increasing Kdz. For very small distances z, jsin(Kdz)/Kdzj is close to 1; however, previous derivations suggest that MeiKz 2iK ðþ1 z eiKz 0 F Pðz0Þð Þ Me iKz 2iK ðþ1 z eiKz 0 FðPðz0ÞÞ dz0 and Me iKz 2iK ðz 0 eiKz 0 F Pðz0Þð Þdz0 approximately cancel for small z, again resulting in a small value. After finding the approximated solution in Eq. (8), the transform of the pressure can then be solved numerically in increments of Dz, to form the field over space. For example, we have31 ðDz 0 eiKzF PðzÞð ÞdzF Pð0Þð ÞDz; ð2Dz 0 eiKzF PðzÞð ÞdzF Pð0Þð ÞDzþ eiKDzF PðDzÞð ÞDz :::: (21) The integral is approximated by the Riemann sum. Although this approximation has a relatively large truncation error compared with higher order integrals, it is very robust and is expected to work well with a large step size for weakly non- linear problems. This approximation, which evaluates inte- grals by the left-hand point rule for Riemann sums, in fact greatly resembles a first-order version of the impulse method for stiff ODEs.32 In both our methods and the impulse method, the propagator of the linear part of the differential equation is used to evolve both the nonlinear term and the initial condition over a large step. This algorithm can be con- trasted with the first-order forward Euler, first-order sym- plectic Euler (leapfrog), second-order velocity verlet, and fourth-order Runge–Kutta explicit scheme for this type of ODE,31 where the step size usually has to be extremely small (in the order of 1/K) for stable integrations. Since the implicit analytic solution for the frequency- domain Westervelt equation is available [i.e., Eq. (8)], it is now possible to also backward propagate waves by simply replacing z by z in Eq. (8),2 Pðkx; ky;z;xÞ ¼ Pðkx; ky; 0;xÞeiKz  bx 2 2iq0c 4 0K eiKz ðz 0 eiKz 0 F Pðz0Þð Þdz0; (22) as Eq. (2) is invariant with respect to the spatial dimension [i.e., if P(kx, ky, z,x) is a solution to Eq. (2), P(kx, ky,z,x) is also a solution]. In contrast, it is noted that the frequency dimension is not invariant, which is a sufficient condition to indicate that the equation is not time invariant. We note that the acoustic time-reversal method is essentially based on the fact that the lossless acoustic wave equation is time invari- ant,33–35 i.e., if p(r, t) is a solution to the wave equation, then p(r,t) is also a solution. This fundamental property does not hold in lossy media, resulting mathematically from the fact that the attenuation term is not an even-order derivative. On the other hand, in Eq. (2), space reversal is valid in the dimension z, even though time reversal does not hold. Appli- cation of the time-reversal method and the present back- ward-projection method are quite different, however, as time reversal is generally realized by temporal phase conjugation of a received signal followed by retransmission, whereas the present method sends the signal back to the source numeri- cally using Eq. (22). It is possible, however, to numerically implement time reversal in a lossy medium by reversing the absorption coefficient.36 In this case, the present algorithm still has advantage over the time-reversal method in terms of sound field reconstruction in a nonlinear medium. Basically, the backward-projection algorithm has all the advantages of the forward model. For example, the backward projection can be easily implemented for arbitrary dispersions. The step size can be relatively large for weakly nonlinear problems. The backward projection also considers interaction of waves in different directions, which is not possible in most time-do- main methods. An additional advantage of working in the frequency domain becomes apparent for cases involving a J. Acoust. Soc. Am., Vol. 129, No. 1, January 2011 Jing et al.: Nonlinear wave propagation 37 Downloaded 18 Mar 2011 to 131.215.220.185. Redistribution subject to ASA license or copyright; see http://asadl.org/journals/doc/ASALIB-home/info/terms.jsp highly absorptive medium: While numerical noise tends to build up exponentially during backward projection, the algorithm can be easily combined with a frequency-domain filter to eliminate or reduce such noise, whereas in the time- domain, filtering is typically more complex and time- consuming. III. NUMERICAL SIMULATIONS A. Algorithm An algorithm was developed to perform the discrete approximation of Eq. (8), using the approximation given by Eq. (21). An initial dataset p(x, y, z0, t) was provided, repre- senting the signal time history over the x-y plane at z ¼ z0 in front of the source. Values were expressed as a grid of nx  ny  nt points, representing the two spatial planes and time, respectively. The values of nx and ny were set to be odd numbers so that the center point is in the middle. The dis- crete spatial coordinates were x ¼ m dx;m ¼ nx=2þ 1=2; :::; nx=2 1=2; y ¼ n dy; n ¼ ny=2þ 1=2; :::; ny=2 1=2: (23) The numbers nx, ny, and nt were determined on a case-by- case basis. Since a Fourier summation results in a periodic function, spectral methods inherently have a wrap-around problem (an outgoing wave enters one boundary and exits from the opposite boundary).37 Therefore, nx and ny must be sufficiently large especially in the far field, where more of the wave spreads into boundary. To minimize this effect, sol- utions near the boundary could be tapered to zero, but was not done in this study. In the present study, the maximum nx and ny used was 121. The number nt was chosen to be slightly larger than T/dt, where T is the time length of the ex- citation signal. Temporal resolution was set by the Nyquist rate Dt ¼ 1 2fmax , where the maximum frequency was set at the highest harmonic to be tracked plus the bandwidth of the ini- tial signal. Spatial resolution requirements were set by the spatial cutoff, giving Dx ¼ Dy ¼ c0 2fmax . However, spatial re- solution can be decreased without losing too much accuracy under special cases where pressure is concentrated in direc- tions along the axis of propagation and the nonlinearity involved is not very strong. In this study, a spatial resolution of Dx ¼ Dy ¼ c0 2fc ¼ k=2 was used for the 3-D problem, where fc is the fundamental frequency and k is the wave- length at the fundamental frequency. A potential disadvantage of the frequency-domain approach is the need to calculate the convolution integral at each iteration of the algorithm, thus offsetting some of the computational advantage of the method. This operation becomes more time intensive as the relevant bandwidth increases. To reduce processing time, selective sampling of k-space can be incorporated. If the signal is propagating approximately along the spatial z axis, the filter generally will be a low pass filter. In this study, the selective sampling of k-space is, however, not applied, as the computational times involved for all the case tested are reasonably short. Nevertheless, a low pass filter applied the constraint that spa- tial frequencies must be <x2=c20; i.e., evanescent waves were neglected. In addition, this filter served the purpose of eliminating numeric explosion from exponentially increasing round-off error during back-projection. B. Verification 1. Error study This section concentrates on error introduced as a function of the projection step size Dz, as formulated by Eq. (21). One motivation for developing the method was its potential ability to take relatively large steps between the projection planes, Dz. It was expected that for weakly non- linear cases, large steps relative to a wavelength could be used without producing large error in the calculation. To test the tradeoffs between step size and accuracy, we per- formed a series of simulations to look at error as a function of propagation distance and step size. We incrementally changed the propagation distance measured in the shock- formation distance r (0.88r, 0.44r, … , 0.0138r) and dz (r/256, r/128, … , r/16) independently, while dt was kept with 32 harmonics being considered. The temporal resolu- tion was chosen to be relatively high because the under- sampling of time-domain should be eliminated as it might influence the accuracy of the solution when changing the step-size dz. Since an analytic solution for plane nonlinear wave propagation is available, it was chosen for this error study. To propagate a plane wave, the sound pressure distribution on the whole initial surface was uniform, and a sinusoidal burst of ten circles was used as the initial signal. For the ex- citation, the frequency was 5 MHz and the initial pressure amplitude was 5 MPa. For the medium, the nonlinearity coefficient was 3.5 and the speed of sound was 1500 m/s. The Fubini solution11 to the Burgers equation was used, which is valid up to the shock-formation distance r in a loss- less media. To quantify the error, we calculated the time-domain L2 error of the present model versus the corresponding exact analytic solution (Fubini solution). The time-domain L2 error is defined as37 e ¼ pnumðtÞ  pexactðtÞk k pexactðtÞk k ; (24) where pðtÞk k is the L2 norm of the time-domain signal p(t). Examination of error as a function of the control varia- bles, as plotted in Fig. 2(a), indicated that error increased as the propagation distance increased. This trend was expected due to increased nonlinearity of the signal, thus causing an eventual breakdown in the band-limited assumptions of the present model. For relatively strong nonlinear cases (z > 0.4r), the error did not increase significantly as the step size changed from r/256 to r/128, but the error did increase significantly when the step size was changed from r/64 to r/16. Overall, results indicated that, for a weakly nonlinear 38 J. Acoust. Soc. Am., Vol. 129, No. 1, January 2011 Jing et al.: Nonlinear wave propagation Downloaded 18 Mar 2011 to 131.215.220.185. Redistribution subject to ASA license or copyright; see http://asadl.org/journals/doc/ASALIB-home/info/terms.jsp problem, a step size of dz ¼ r/16 (equivalent to k in this spe- cific case) was still able to provide good accuracy (L2 error smaller than 0.001) while maintaining computational effi- ciency [less than 1 s for plane-wave simulation on a personal laptop: Dual-core 2.00 GHz processors and 3 GB of random access memory (RAM)], provided that the temporal resolu- tion was sufficiently fine. Even for a strongly nonlinear case (z ¼ 0.88r), the error generated by using a step size ¼ r/16 may be considered tolerable relative to the error typically introduced in experimental measurement. In contrast, the fi- nite element method,3 which solves the time-domain nonlin- ear wave equation using a predictor/multi-corrector algorithm in combination with standard time-stepping procedures, requires up to 80 elements per wavelength to obtain the Fubini solution. It is noted that the projection size determined here is based on plane-wave propagation in homogeneous media. For accurate results in cases containing diffraction, the step size must be reduced. However, as long as the regime is not at, or near, the shock-formation distance, a standard step size of r/64 is sufficient. Therefore, the method proposed here has the advantage that the z-step for calculating the nonlinear term can be much larger than in the conventional time–space derivative scheme, where fast changes of the wave profile must be accounted for, and the z-step must be a small portion of the shock-formation distance. Here, fast changes are in- cluded in the phase exponential coefficient, similar to the KZK or Burgers equation, where they are accounted by oper- ating in the retarded time variable. That is why in the limit- ing case of linear propagation the step can be arbitrary. Lastly, to demonstrate the validity of Eq. (8) near or beyond the shock distance, an example was considered that compares the numerical method with the Fay solution to the Burgers equation,11 which is devised to provide an accurate solution when the propagation distance is larger than 3r and the diffusivity is small. In the present study, a distance of 3.3r and diffusivity of 2  105 was selected. Dz was cho- sen to be r/512, and the temporal resolution dt was increased to 1/(256fc) so that 128 harmonics were considered. The very fine temporal resolution was chosen because shock wave has a spectrum that converges slowly toward high fre- quencies and need more harmonics to represent the wave front. Figure 2(b) shows the comparison, and the agreement is good. The L2 error is 0.02. Note that the present frequency-domain model is inher- ently most practically applicable to non-shockwave prob- lems where only a limited number of harmonics need to be considered. Although still valid for cases of stronger nonli- nearity, the computational advantage is diminished. To bet- ter apply the present model to shock wave propagation while maintaining efficiency, a limited-harmonic nonlinear algo- rithm could be used, e.g., limiting the steepness of the shock- fronts by artificially increasing the attenuation.5 However, further development of this technique is beyond the scope of this work and not further discussed here. 2. Directional independence To test the directional independence of the nonlinear field solution, a 2-D steered transducer problem was explored. A 1 MHz fundamental frequency of continuous wave signal with amplitude of 1 MPa was used to excite a 15 cm continuous line array. The sound speed was set to 1500 m/s, the density to 1000 kg/m3, and the nonlinearity coefficient to 3.5. No attenuation was considered. The size of the transducer was much larger than the fundamental wavelength, so that the sound field along the center of the beam was nearly planar within a certain distance. The time step for the spectral method was set to be 1/(64fc). The spa- tial step dz and dx were set to 1/8k. Ideally, for different steering angles (different phase distributions on the trans- ducer), the field along each beam-path should be identical for points equidistant from the center of the transducer. Figure 3 shows the deviation of results at the first three fre- quencies to their mean values with changing steering angles. The results were obtained at a distance of 39 mm to the cen- ter of the source. The steering angle changes from 0 to 70 (angle with respect to the z axis). A larger angle was not used due to the large computational domain it requires. FIG. 2. (a) Curves of errors for the present method showing the L2 error for forward projection step size and propagation distance measured in shock- formation distance r. (b) Comparison between the present method and ana- lytic solution for one-dimensional nonlinear wave propagation at 3.3r. J. Acoust. Soc. Am., Vol. 129, No. 1, January 2011 Jing et al.: Nonlinear wave propagation 39 Downloaded 18 Mar 2011 to 131.215.220.185. Redistribution subject to ASA license or copyright; see http://asadl.org/journals/doc/ASALIB-home/info/terms.jsp The maximum deviation is below 5%, confirming the direc- tional independence of the current method. 3. Comparison with ASA code Next, the model was applied to a more complex 3-D scenario. For comparison, we simulated identical initial fields in the forward direction both using the present algo- rithm and an established nonlinear code. For this purpose, an open code software package designed to simulate ultrasound wave propagation (Abersim)28 was used. This package was developed at the Department of Circulation and Medical Imaging at the Norwegian University of Science and Tech- nology (NTNU), and deals with the diffraction, nonlinearity, and attenuation using an operator splitting approach. Similar to the present algorithm, the diffraction term is solved using the angular spectrum approach. However, this algorithm only projects sound in the forward direction. Nonlinearity is only accounted for a wave traveling parallel to the z axis, since a plane-wave assumption is made, in the term account- ing for nonlinearity, the sound pressure p is only a function of z and t.38 In addition, attenuation in the algorithm is con- sidered to obey a power law and is realized by a convolution. In contrast, in the present algorithm, the dependence of attenuation on frequency is arbitrary, and can be easily implemented without requiring convolution. For testing, a 3-D example was addressed. The configu- ration simulated a concave circular transducer (single ele- ment) with an aperture radius of 10 mm and a 75 mm focal distance. The delay time used to create the focus was calcu- lated by (dd0)/c0, where d is the distance from a point on the transducer to the focus and d0 is the distance from the center of the transducer to the focus. The initial time-domain signal was Gaussian-shaped. The center frequency was 1 MHz, the fractional bandwidth was 0.3, and the initial peak pressure was 0.75 MPa. The excitation signal can be found in Fig. 4(a), its spectrum can also be found in Fig. 4(b). Figure 4(c) shows the spatial distribution for the fundamental frequency component along the x axis. It is noted that the distribution seems uniform as would be expected, since the time delay only changes the phase not the magnitude of the pressure. Figure 4(d) shows the spatial spectrum again for the fundamental frequency (kc ¼ 2pfc/c0). For the fundamental frequency, kx/kc ranges from 1 to 1, which represents the full range of possible propagation directions. Likewise for the sub-harmonic frequency, the range is expected to be from 2 to 2. It is well known that the spatial spectrum larger than 1 or smaller than 1 repre- sents evanescent waves, therefore they will be filtered out in the current algorithm. For higher harmonics, the range is nar- rower than from 1 to 1, which does not cover the full range, but the error introduced is expected to be small because there is more directivity at higher harmonics. Human muscle was modeled by setting the sound speed to 1549.9 m/s, the density to 1060 kg/m3, the nonlinear pa- rameter to b 3.9, and the attenuation to obey the power law as a(f ) ¼ a  f b, where a was 0.52 dB/cm and b was 1.1.39 The temporal resolution in Abersim was set to 1/(512fc), as the Abersim simulation results converge well at this tempo- ral resolution. Noticeable numerical damping was observed in Abersim at larger time steps. This was potentially due to Abersim’s use of the method of characteristics,9,38 which can cause interpolation error when solving the nonlinear term. It was previously reported that “good results are obtained using a temporal grid of 10–15 samples per period at the highest harmonic frequency that should be accurately computed.”9 The time step for the present spectral method was set to be 1/(64fc) at which the result converges. It is noted that numerical damping has not been observed in the present model for large time steps. The spatial step, dz, in the present algorithm was set to 1/4k, while in Abersim a sub-cycling step given by Dz ¼ c0/2pfc was used. The sound diffusivity d was calculated through the equation a ¼ dx2/ 2c0 3, where a is the attenuation coefficient.11 The dispersion obeys the Kramers–Kronig relations and is written as21 1 cw ¼ 1 c0 þ a tan pb 2   xj jb1 x0j jb1  : (25) Prior to simulating nonlinear media, both the present code and Abersim were tested for linear cases (b ¼ 0) with and without attenuation. The two approaches were found to have excellent agreement. To save space, the linear results are not presented here. Time-domain solutions at the focus [Fig. 4(e)] as well as the frequency-domain solution for the first four harmonics [Fig. 4(f)] both indicate good agreement between the two methods. The time-domain L2 error was not estimated because different temporal resolutions were used. The total calculation time of the present approach for this 3-D wave propagation problem is less than 15 min when implemented using MATLAB, on a XP 64-bit operating system. The hardware consisted of four dual-core 2.67 GHz Xeon processors, and 24 GB of RAM. The matrix size of the pres- sure p is 121  121  1025. Therefore, the present approach captures the whole solution of the Westervelt equation in a computationally efficient manner. FIG. 3. Deviation of results at the first three frequencies to their mean values for a steering transducer as a function of the steering angle. 40 J. Acoust. Soc. Am., Vol. 129, No. 1, January 2011 Jing et al.: Nonlinear wave propagation Downloaded 18 Mar 2011 to 131.215.220.185. Redistribution subject to ASA license or copyright; see http://asadl.org/journals/doc/ASALIB-home/info/terms.jsp C. Backward projection A key advantage of the present approach is the ability to propagate a nonlinear signal both toward and away from the source. Thus, a signal could be recorded at a given distance from the source, and then back-projected to give information about the signal near a transducer face, assuming the propa- gating field is contained within the measurement plane, z0. FIG. 4. (a) Initial pressure in the center of the transducer for the three-dimensional simulation (1025 grid points). (b) Waveform spectrum of the initial pres- sure in the center of the transducer (32 harmonics). (c) Spatial distribution for the fundamental frequency component along the x axis (121 grid points). (d) Spatial spectrum for the fundamental frequency. (e) Time-domain comparison between the present method and Abersim at the focus (z ¼ 75 mm) for three- dimensional nonlinear wave propagation from a single-element circular transducer in muscle tissue. (f) Frequency-domain comparison (first four harmonics). J. Acoust. Soc. Am., Vol. 129, No. 1, January 2011 Jing et al.: Nonlinear wave propagation 41 Downloaded 18 Mar 2011 to 131.215.220.185. Redistribution subject to ASA license or copyright; see http://asadl.org/journals/doc/ASALIB-home/info/terms.jsp As discussed in Sec. II, this property can be contrasted with time reversal methods, which are violated in the presence of the absorption term.33 We demonstrate this ability by projec- ting the forward-propagated signals from a transducer back- ward to the source location, where they are compared with the original signal. Two cases were tested for nonlinear wave propagation in different acoustic media. In the first case, the forward pro- jected sound field was obtained from the example in Sec. III B 3 at the focal plane z ¼ 75 mm, where the simulated acous- tic medium was human muscle. For the backward projection, the time step was 1/(64fc) and step-size dz was 1 4 wavelength at the center frequency. The time history of the obtained sig- nal along the x axis (y ¼ 0, z ¼ 75 mm) is provided in Fig. 5(a). This signal was backward projected to the z ¼ 0 plane as shown in Fig. 5(b). The initial signal at z ¼ 0 mm is shown in Fig. 5(c). The L2 error was 0.09. More detailed compari- son is shown for a point in the center of the transducer in the time-domain (Fig. 6). For reference, the linear backward pro- jection (b ¼ 0) is also implemented and plotted. It can be seen that in a nonlinear acoustic medium, the linear backward projection is inaccurate. Consequently, use of such linear methods to characterize a field in a nonlinear medium can be expected to lead to erroneous results. Accordingly, the L2 error for the linear backward projection was 0.27, signifi- cantly larger than the error for nonlinear projection. While a comprehensive study is not presented here, this error is expected to increase as nonlinearity increases. The second scenario considered a dispersion relation described by the frequency-dependent phase velocity given as c ¼ 1525  2.5  105 f(Hz). The attenuation was given as a(f) ¼ 13.3  f1.09 þ 0.05 (dB/cm). The velocity26 and attenuation40 were within the range that may be found, for example, in human cancellous bone. To apply the present theorem, it is assumed that the ultrasound is nearly normally incident upon the bone surface, such that only longitudinal waves are generated, and the Westervelt equation might be a good approximation.41 The density was assumed to be 1850 kg/m3.27 The nonlinearity coefficient b was 72.42 The for- ward projected sound field was obtained from a concave circular transducer with an aperture radius of 10 mm and a focus distance of 60 mm. The excitation signal was the same in Fig. 4(a) except that the peak amplitude was reduced to 0.25 MPa. For both the forward and backward projec- tions, the time step was 1/(32fc) and step-size dz was 1 4 wavelength. In comparison with the first case simulating muscle, the attenuation in the second case was significantly enhanced and was modeled by a nonlinear power fit. The nonlinear coeffi- cient was also increased. For these reasons, a specific low FIG. 5. (a) Three-dimensional forward-projected signal at the focus plane (z ¼ 75 mm, y ¼ 0 mm). (b) Three-dimensional backward-projected signal at the source position (z ¼ 0 mm, y ¼ 0 mm). (c) Initial signal at the source position (z ¼ 0 mm, y ¼ 0 mm). The medium is human muscle. FIG. 6. Comparison of the nonlinear backward-projected signal, linear backward-projected signal, and initial signal on the center of the transducer. The medium is human muscle. 42 J. Acoust. Soc. Am., Vol. 129, No. 1, January 2011 Jing et al.: Nonlinear wave propagation Downloaded 18 Mar 2011 to 131.215.220.185. Redistribution subject to ASA license or copyright; see http://asadl.org/journals/doc/ASALIB-home/info/terms.jsp pass frequency-domain filter was applied to the backward projection. The need for the filter came from the approxima- tion that the attenuation obeys the same law for the whole fre- quency range. This assumption was made to simplify the numerical simulation. Therefore, in our simulation, the attenuation was extremely large at a very high frequency. This introduced an issue for the backward projection, as the attenuation term amplified the signal exponentially during the backward projection, and a small numerical noise at a very high frequency relative to the frequency content of the signal quickly led toward infinity. The cut-off frequency of a low- pass filter in such situations, however, is commonly deter- mined based on the spectral analysis of the relevant sound field. In this case, spectral analysis showed that the signal was extremely small after the third harmonic (3 MHz). Therefore, the cut-off frequency was set at 3 MHz. Once again, the forward projected field at the focal plane (z ¼ 60 mm) was initially generated. The time history of the obtained signal along the x axis (y ¼ 0, z ¼ 60 mm) is shown in Fig. 7(a). This signal was backward projected to the z ¼ 0 plane as shown in Fig. 7(b). The initial signal at z ¼ 0 mm is shown in Fig. 7(c). The L2 error was 0.1. The linear projec- tion was again also implemented and the L2 error was 0.37. A detailed comparison of sound pressure of a point in the center of the transducer is shown in Fig. 8. Overall, the wave reconstructions demonstrate the potential of the present method to accurately backward project a signal in a nonlin- ear medium. V. SUMMARYAND CONCLUSION The present nonlinear wave-vector-frequency-domain representation of the Westervelt equation has been shown to yield an implicit analytic solution. Its original form is not suitable for numerical implementation; therefore, its approximation was found and numerically solved. In the approach, diffraction is calculated through the solution to the homogenous frequency-domain Westervelt equation, while the nonlinearity is calculated by the particular solu- tion through a Green’s function. Comparisons between the present method and other well-established methods, includ- ing analytic solutions, validate the accuracy and efficiency of the approach. Moreover, the analytic solution of the pres- ent method permits projection of acoustic waves from an initial measurement plane to distances closer to the source. This backward-projection technique was also verified numerically. This study suggests that, similar to its linear counterpart, measurement of time and spatially resolved pressure across a single plane could provide data to characterize an entire FIG. 7. (a) Three-dimensional forward-projected signal at the focus plane (z ¼ 60 mm, y ¼ 0 mm). (b) Three-dimensional backward-projected signal at the source position (z ¼ 0 mm, y ¼ 0 mm). (c) Initial signal at the source position (z ¼ 0 mm, y ¼ 0 mm). The medium is human cancellous bone. FIG. 8. Comparison of the nonlinear backward-projected signal, linear backward-projected signal, and initial signal on the center of the transducer. The medium is human cancellous bone. J. Acoust. Soc. Am., Vol. 129, No. 1, January 2011 Jing et al.: Nonlinear wave propagation 43 Downloaded 18 Mar 2011 to 131.215.220.185. Redistribution subject to ASA license or copyright; see http://asadl.org/journals/doc/ASALIB-home/info/terms.jsp field, including nonlinear induction of both harmonic and sub-harmonic wave components. A single plane also has the potential to characterize the radiative behavior of its source.2 This could be particularly useful in the case of high power transducers, where the source itself commonly radiates higher harmonics of the fundamental. In this case, the back- projection could serve to separate source signals from me- dium-dependent acoustic nonlinear effects. The present examples are simulated using ideal condi- tions. It is expected that in the absorptive case, appreciable signal strength will be required for accurate back projection, with the precise requisite signal-to-noise ratio as a function of the desired accuracy. Planar projection is shown to be valid under arbitrary dispersion conditions for both forward and backward propagation. This could prove particularly useful under conditions of anomalous dispersion, and pro- vides a straightforward and computationally efficient method for predicting behavior in dispersive media. Although the current algorithm was limited only to homogeneous situa- tions, the method is expected to be applicable under more general conditions.43 ACKNOWLEDGMENTS This work was supported, in part, by NIH Grant No. U41 RR019703-028722. The authors would like to thank Dr. Caleb Farny for a critical review of the manuscript and three anon- ymous reviewers for very constructive comments. APPENDIX A This appendix derives the solution to Eq. (2). It is convenient to move the nonlinear term in Eq. (2) to the right hand side of the equation, where it may now be viewed as a “source function” for the equation, albeit one that is only known over a given initial plane at z0. In this representation an implicit solution to Eq. (2) may be expressed in terms of an integral equation using the 1-D Green’s function30 Gðz; z0Þ ¼ i 2K ðeiK zz0j j  eiK zþz0j jÞ; 0  z; z0 < 1 (A1) and the known homogeneous solution. The general solution can be written as PðzÞ ¼ AeiKzþBeiKzþ bx 2 2iq0c 4 0K ðz 0 eiKðzz 0Þ  eiKðzþz0Þ  F Pðz0Þð Þdz0  þ ðþ1 z eiKðzz 0Þ  eiKðzþz0Þ  F Pðz0Þð Þdz0  ¼ AeiKzþBeiKzþ bx 2 2iq0c 4 0K ðz 0 eiKðzz 0Þ  eiKðzþz0Þ  F Pðz0Þð Þdz0   ðz 0 eiKðzz 0Þ  eiKðzþz0Þ  F Pðz0Þð Þdz0 þ ðþ1 0 eiKðzz 0Þ  eiKðzþz0Þ  F Pðz0Þð Þdz0  ¼ AeiKzþBeiKzþ bx 2 2iq0c 4 0K ðz 0 eiKðzz 0Þ  eiKðzz0Þ  F Pðz0Þð Þdz0  þ ðþ1 0 eiKðzz 0Þ  eiKðzþz0Þ  F Pðz0Þð Þdz0  ¼ AeiKzþBeiKz bx 2 2iq0c 4 0K eiKz ðz 0 eiKz 0 F Pðz0Þð Þdz0  eiKz ðz 0 eiKz 0 F Pðz0Þð Þdz0   þ bx 2ðeiKz eiKzÞ 2iq0c 4 0K ðþ1 0 eiKz 0 F Pðz0Þð Þdz0; (A2) where F Pðz0Þð Þ ¼ Pðkx; ky; z0;xÞ  Pðkx; ky; z0;xÞ: (A3) Since Ðþ1 0 eiKz 0 F Pðz0Þð Þdz0 is a constant with respect to z, it merges into A and B, which leads to PðzÞ ¼ AeiKz þ BeiKz  bx 2 2iq0c 4 0K  eiKz ðz 0 eiKz 0 F Pðz0Þð Þdz0  eiKz ðz 0 eiKz 0 F Pðz0Þð Þdz0  : (A4) The task now is to determine A and B, which need boundary conditions. Applying the initial condition at the source plane leads to A ¼ P(0)  B. Imposing the well-known Sommer- feld radiation condition lim z!1 dP dz  iKP   ¼ 0 (A5) yields B ¼ M 2iK ðþ1 0 eiKz 0 F Pðz0Þð Þdz0; (A6) where M ¼ bx2=q0c40: The final solution can be now written as PðzÞ ¼ Pð0ÞeiKz þMe iKz 2iK ðþ1 z eiKz 0 F Pðz0Þð Þ Me iKz 2iK ðþ1 z eiKz 0 F Pðz0Þð Þdz0 þMe iKz 2iK ðz 0 eiKz 0 F Pðz0Þð Þdz0  ðz 0 eiKz 0 F Pðz0Þð Þdz0   : (A7) 44 J. Acoust. Soc. Am., Vol. 129, No. 1, January 2011 Jing et al.: Nonlinear wave propagation Downloaded 18 Mar 2011 to 131.215.220.185. Redistribution subject to ASA license or copyright; see http://asadl.org/journals/doc/ASALIB-home/info/terms.jsp APPENDIX B This appendix discusses the third harmonics generated by a continuous wave source under the weakly nonlinear approxima- tion. For the third harmonics, the right hand side of Eq. (7) reads M3e iK2z 2iK3 ðz 0 eiK3z 0 F Pðz0Þð Þdz0 ¼ 2M3e iK2z 2iK3 ðz 0 ð eiK3z 0 Px1ðz;K0  ~K0ÞPx2ðz; ~K0Þdz0d ~K0; (B1) where M3 ¼ bx 2 3 q0c 4 0 ; Px1 and Px2 are pressures at x1 and x2, respectively. Substituting Eq. (12) into Eq. (B1), we have 2M3e iK3z 2iK3 ðz 0 ð eiK3z 0 Px1ðz;K0  ~K0ÞPx2ðz; ~K0Þdz0d ~K0 ¼ M3e iK3z iK3 4bk21 q0c 2 0 ðz 0 ð eiK3z 0 Pð0;K0  ~K0ÞeiKbz0 ð eiðK 02 a þK 02 b Þz  eiK02z K 02 2  ðK0a þ K0bÞ2 Pð0; ~K00ÞPð0; ~K0  ~K00Þd ~K00d ~K0dz0 ¼ M3e iK3z iK3 4bk21 q0c 2 0 ð ð ðz 0 eiðKbK3Þz 0 eiðK 02 a þK 02 b Þz0  eiK02z0 K 02 2  ðK0a þ K0bÞ2 Pð0;K0  ~K0ÞPð0; ~K00ÞPð0; ~K0  ~K00Þdz0d ~K00d ~K0 ¼ M3 K3 4bk21 q0c 2 0 ð ð ðK02  K3 þ KbÞeiðK0aþK0bþKbÞz ðK0a þ K0b  K3 þ KbÞðK02  K3 þ KbÞ K 022  ðK0a þ K0bÞ2 h iPð0;K0  ~K0ÞPð0; ~K00ÞPð0; ~K0  ~K00Þd ~K00d ~K0 þ ðK 0 a þ K0b  K3 þ KbÞeiðK 0 2 þKbÞz þ ðK0a þ K0b  K02ÞeiK3z ðK0a þ K0b  K3 þ KbÞðK02  K3 þ KbÞ K 022  ðK0a þ K0bÞ2 h iPð0;K0  ~K0ÞPð0; ~K00ÞPð0; ~K0  ~K00Þd ~K00d ~K0; (B2) where K0a ¼ ffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffi x1 c0  2  ~K00 2 s ; K0b ¼ ffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffi x1 c0  2  ~K0  ~K00 2 s ; Kb ¼ ffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffi x1 c0  2  K0  ~K0 2 s ; K02 ¼ ffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffi x2 c0  2  ~K0 2 s ; K3 ¼ ffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffi x3 c0  2  K0j j2 s : Similarly, we have for the left hand side of Eq. (7) M2e iK2z 2iK2 ðþ1 z eiK2z 0 F Pðz0Þð Þdz0 M2e iK2z 2iK2 ðþ1 z eiK2z 0 F Pðz0Þð Þdz0 M2e iK2z 2iK2 ðz 0 eiKz 0 F Pðz0Þð Þdz0 ¼ M3 K3 4bk21 q0c 2 0 ð ð ðK0a þ K0b þ K3 þ KbÞeiðK02þKbÞz ðK0a þ K0b þ K3 þ KbÞðK02 þ K3 þ KbÞ K 022  ðK0a þ K0bÞ2 h iPð0;K0  ~K0ÞPð0; ~K00ÞPð0; ~K0  ~K00Þd ~K00d ~K0  ðK 0 2 þ K3 þ KbÞeiðK 0 aþK0bþKbÞz þ ðK0a þ K0b  K02ÞeiK3z ðK0a þ K0b þ K3 þ KbÞðK02 þ K3 þ KbÞ K 022  ðK0a þ K0bÞ2 h iPð0;K0  ~K0ÞPð0; ~K00ÞPð0; ~K0  ~K00Þd ~K00d ~K0: (B3) Although it is not mathematically obvious that Eq. (7) holds for the third harmonics, for the 1-D case, Eq. (B3) reduces to zero while Eq. (B2) does not. The 2-D example used in Sec. II is again used for the verification of Eq. (7). The details of the configuration of this 2-D problem can be found in Sec. II. Figure 9 illustrates the results along the lateral dimension at J. Acoust. Soc. Am., Vol. 129, No. 1, January 2011 Jing et al.: Nonlinear wave propagation 45 Downloaded 18 Mar 2011 to 131.215.220.185. Redistribution subject to ASA license or copyright; see http://asadl.org/journals/doc/ASALIB-home/info/terms.jsp a distance of 1.9 cm from the source, for partial solution [Eq. (B2)] and complete solution [Eq. (B2) þ Eq. (B3)]. It can be observed that these two results are indistinguishable. 1M. Forbes, S. Letcher, and P. Stepanishen, “A wave vector, time-domain method of forward projecting time-dependent pressure fields,” J. Acoust. Soc. Am. 90, 2782–2793 (1991). 2G. T. Clement and K. Hynynen, “Field characterization of therapeutic ultrasound phased arrays through forward and backward planar projec- tion,” J. Acoust. Soc. Am. 108, 441–446 (2000). 3J. Hoffelner, H. Landes, M. Kaltenbacher, and R. Lerch, “Finite element simu- lation of nonlinear wave propagation in thermoviscous fluids including dis- sipation,” IEEE Trans. Ultrason. Ferroelectr. Freq. Control 48, 779–786 (2001). 4C. J. Vecchio, M. E. Schafer, and P. A. Lewin, “Prediction of ultrasonic field propagation through layered media using the extended angular spec- trum method,” Ultrasound Med. Biol. 20, 611–622 (1994). 5P. T. Christopher and K. J. Parker, “New approaches to nonlinear diffrac- tive field propagation,” J. Acoust. Soc. Am. 90, 488–499 (1991). 6J. Tavakkoli, D. Cathignol, R. Souchon, and O. A. Sapozhnikov, “Modeling of pulsed finite-amplitude focused sound beams in time domain,” J. Acoust. Soc. Am. 104, 2061–2072 (1998). 7P. Westervelt, “Parametric acoustic array,” J. Acoust. Soc. Am. 35, 535– 537 (1963). 8G. Taraldsen, “A generalized Westervelt equation for nonlinear medical ultrasound,” J. Acoust. Soc. Am. 109, 1329–1333 (2001). 9T. Varslot and G. Taraldsen, “Computer simulation of forward wave prop- agation in soft tissue,” IEEE Trans. Ultrason. Ferroelectr. Freq. Control 52, 1473–1482 (2005). 10V. Kuznetsov, “Equations of nonlinear acoustics,” Sov. Phys. Acoust. 16, 467–470 (1971). 11M. F. Hamilton and D. T. Blackstock, Nonlinear Acoustics (Academic Press, San Diego, 1998), pp. 54–117. 12M. A. Averkiou and M. F. Hamilton, “Nonlinear distortion of short pulses radiated by plane and focused circular pistons,” J. Acoust. Soc. Am. 102, 2539–2548 (1997). 13G. F. Pinton and G. E. Trahey, “A comparison of time-domain solutions for the full-wave equation and the parabolic wave equation for a diagnos- tic ultrasound transducer,” IEEE Trans. Ultrason. Ferroelectr. Freq. Con- trol 55, 730–733 (2008). 14B. J. Landsberger and M. F. Hamilton, “Second-harmonic generation in sound beams reflected from, and transmitted through, immersed elastic solids,” J. Acoust. Soc. Am. 109, 488–500 (2001). 15Z. Xiao-Feng, Z. Lin, Z. Dong, and G. Xiu-Fen, “Nonlinear propagation of focused ultrasound in layered biological tissues based on angular spec- trum approach,” Chin. Phys. 14, 1594–1599 (2005). 16J. Huijssen and M. D. Verweij, “An iterative method for the computation of nonlinear, wide-angle, pulsed acoustic fields of medical diagnostic transducers,” J. Acoust. Soc. Am. 127, 33–44 (2010). 17S. S. Kashcheeva, O. A. Sapozhnikov, V. A. Khokhlova, M. A. Averkiou, and L. A. Crum, “Nonlinear distortion and attenuation of intense acoustic waves in lossy media obeying a frequency power law,” Acoust. Phys. 46, 170–177 (2000). 18V. A. Khokhlova, A. E. Ponomarev, M. A. Averkiou, and L. A. Crum, “Nonlinear pulsed ultrasound beams radiated by rectangular focused diag- nostic transducers,” Acoust. Phys. 52, 481–489 (2006). 19W. Chen and S. Holm, “Modified Szabo’s wave equation models for lossy media obeying frequency power law,” J. Acoust. Soc. Am. 114, 2570– 2574 (2003). 20T. Szabo, “Time domain wave equations for lossy media obeying a fre- quency power law,” J. Acoust. Soc. Am. 96, 491–500 (1994). 21K. R. Waters, M. S. Hughes, G. H. Brandenburger, and J. G. Miller, “On a time-domain representation of the Kramers-Kronig dispersion relations,” J. Acoust. Soc. Am. 108, 556–563 (2000). 22M. Liebler, S. Ginter, T. Dreyer, and R. Riedlinger, “Full wave modeling of therapeutic ultrasound: Efficient time-domain implementation of the fre- quency power-law attenuation,” J. Acoust. Soc. Am. 116, 2742–2750 (2004). 23G. Norton and J. Novarini, “Including dispersion and attenuation in time domain modeling of pulse propagation in spatially-varying media,” J. Comput. Acoust. 12, 501–519 (2004). 24G. Norton and J. Novarini, “Finite-difference time-domain simulation of acoustic propagation in dispersive medium: An application to bubble clouds in the ocean,” Comput. Phys. Commun. 174, 961–965 (2006). 25M. Wismer, “Finite element analysis of broadband acoustic pulses through inhomogenous media with power law attenuation,” J Acoust. Soc. Am. 120, 3493–3502 (2006). 26J. D. Jackson, Classical Electrodynamics, 3rd ed. (Wiley, New York, 1998), pp. 295–352. 27K. A. Wear, “A stratified model to predict dispersion in trabecular bone,” IEEE Trans. Ultrason. Ferroelectr. Freq. Control 48(4), 1079–1083 (2001). 28M. Frijlink, H. Kaupang, T. Varslot, and S. Ma˚søy, “Abersim: A simula- tion program for 3D nonlinear acoustic wave propagation for arbitrary pulses and arbitrary transducer geometries,” in 2008 Proceedings of the IEEE Ultrasonics Symposium (2008), pp. 1282–1285. 29G. T. Clement, “Nonlinear planar forward and backward projection,” in 2008 Proceedings of the IEEE Ultrasonics Symposium (2008), pp. 1800–1803. 30P. M. Morse and H. Feshbach, Methods of Theoretical Physics (McGraw Hill Book Company, New York, 1953), pp. 803–844. 31J. Kiusalaas, Numerical Methods for Engineering with MATLAB (Cambridge University Press, New York, 2005), pp. 200–251. 32H. Grubmuller, H. Heller, A. Windemuth, and K. Schulten, “Generalized Verlet algorithm for efficient molecular dynamics simulations with long- range interactions,” Mol. Sim. 6, 121–142 (1991). 33M. Fink, “Time reversal of ultrasonic fields-Part I: Basic principles” IEEE Trans. Ultrason. Ferroelectr. Freq. Control 39(5), 555–566 (1992). 34O. Couture, J.-F. Aubry, G. Montaldo, M. Tanter, and M. Fink, “Suppression of tissue harmonics for pulse-inversion contrast imaging using time reversal,” Phys. Med. Biol. 53, 5469–5480 (2008). 35O. A. Sapozhnikov, Yu. A. Pishchalnikov, and A. V. Morozov, “Reconstruction of the normal velocity distribution on the surface of an ul- trasonic transducer from the acoustic pressure measured on a reference surface,” Acoust. Phys. 49, 354–360 (2003). 36Y. Xu and L. V. Wang, “Time reversal and its application to tomography with diffracting sources,” Phys. Rev. Lett. 92, 033902 (2004). 37T. D. Mast, L. P. Souriau, D. L. Liu, M. Tabei, A. I. Nachman, and R. C. Waag, “A k-space method for large-scale models of wave propagation in tissue,” IEEE Trans. Ultrason. Ferroelectr. Freq. Control 48, 341–354 (2001). 38Abersim User’s Manual (Faculty of Medicine, The Norwegian University of Science and Technology, Norway, 2008). 39F. A. Duck, Physical Properties of Tissue (Academic Press, London, 1990). 40S. Chaffai, F. Padilla, G. Berger, and P. Laugier, “In vitro measurement of the frequency-dependent attenuation in cancellous bone between 0.2 and 2 MHz,” J. Acoust. Soc. Am. 108, 1281–1289 (2000). 41M. Hayner and K. Hynynen, “Numerical analysis of ultrasonic transmis- sion and absorption of oblique plane waves through the human skull,” J. Acoust. Soc. Am. 110, 3319–3330 (2001). 42G. Renaud, S. Calle, J. P. Remenieras, and M. Defontaine, “Exploration of trabecular bone nonlinear elasticity using time-of-flight modulation,” IEEE Trans. Ultrason. Ferroelectr. Freq. Control 55(7), 1497–1506 (2008). 43G. T. Clement and K. Hynynen, “Forward planar projection through lay- ered media,” IEEE Trans. Ultrason. Ferroelectr. Freq. Control 50(12), 1689–1698 (2003). FIG. 9. The sound pressure amplitude of the third harmonic along the lat- eral dimension for different solutions. 46 J. Acoust. Soc. Am., Vol. 129, No. 1, January 2011 Jing et al.: Nonlinear wave propagation Downloaded 18 Mar 2011 to 131.215.220.185. Redistribution subject to ASA license or copyright; see http://asadl.org/journals/doc/ASALIB-home/info/terms.jsp 